{"version":3,"sources":["../../src/auth/auth.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { UsersService } from '../users/users.service';\nimport { JwtService } from '@nestjs/jwt';\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class AuthService {\n  constructor(\n    private usersService: UsersService,\n    private jwtService: JwtService,\n  ) {}\n\n  async validateUser(username: string, pass: string): Promise<any> {\n    const user = await this.usersService.findOne(username);\n    if (user && (await bcrypt.compare(pass, user.password))) {\n      const { password, ...result } = user;\n      return result;\n    }\n    return null;\n  }\n\n  async login(user: any) {\n    const payload = { username: user.username, sub: user.id, role: user.role };\n    return {\n      access_token: this.jwtService.sign(payload),\n    };\n  }\n\n  async register(user: any) {\n    const hashedPassword = await bcrypt.hash(user.password, 10);\n    const newUser = await this.usersService.create({\n      ...user,\n      password: hashedPassword,\n    });\n    const { password, ...result } = newUser;\n    return result;\n  }\n}\n"],"names":["AuthService","validateUser","username","pass","user","usersService","findOne","bcrypt","compare","password","result","login","payload","sub","id","role","access_token","jwtService","sign","register","hashedPassword","hash","newUser","create"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBANc;8BACE;qBACF;gEACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGjB,IAAA,AAAMA,cAAN,MAAMA;IAMX,MAAMC,aAAaC,QAAgB,EAAEC,IAAY,EAAgB;QAC/D,MAAMC,OAAO,MAAM,IAAI,CAACC,YAAY,CAACC,OAAO,CAACJ;QAC7C,IAAIE,QAAS,MAAMG,QAAOC,OAAO,CAACL,MAAMC,KAAKK,QAAQ,GAAI;YACvD,MAAM,EAAEA,QAAQ,EAAE,GAAGC,QAAQ,GAAGN;YAChC,OAAOM;QACT;QACA,OAAO;IACT;IAEA,MAAMC,MAAMP,IAAS,EAAE;QACrB,MAAMQ,UAAU;YAAEV,UAAUE,KAAKF,QAAQ;YAAEW,KAAKT,KAAKU,EAAE;YAAEC,MAAMX,KAAKW,IAAI;QAAC;QACzE,OAAO;YACLC,cAAc,IAAI,CAACC,UAAU,CAACC,IAAI,CAACN;QACrC;IACF;IAEA,MAAMO,SAASf,IAAS,EAAE;QACxB,MAAMgB,iBAAiB,MAAMb,QAAOc,IAAI,CAACjB,KAAKK,QAAQ,EAAE;QACxD,MAAMa,UAAU,MAAM,IAAI,CAACjB,YAAY,CAACkB,MAAM,CAAC;YAC7C,GAAGnB,IAAI;YACPK,UAAUW;QACZ;QACA,MAAM,EAAEX,QAAQ,EAAE,GAAGC,QAAQ,GAAGY;QAChC,OAAOZ;IACT;IA7BA,YACE,AAAQL,YAA0B,EAClC,AAAQY,UAAsB,CAC9B;aAFQZ,eAAAA;aACAY,aAAAA;IACP;AA2BL"}